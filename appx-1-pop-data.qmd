# Historic Population Data and its Georeferences {#sec-AppxPopData}

```{r}
#| label: appx1-packages-data

require(tidyverse)

options(scipen = 10)

# Load population data
if (!file.exists('data/temp/population.RData')) {
  stop('Please run prep-population-data.R before running this script')
} else {
  load('data/temp/population.RData')
}
```

The R script [`prep-pop-data.R`](./prep-pop-data.R) prepares the historical population data and its georeferences for joining it with the weather data and using it in the econometric estimation.
The script is submitted together with this thesis paper, but can also be retrieved via the Git repo of this thesis project [@arendt-2025-mathesis-git-repo].
This appendix ([-@sec-AppxPopData]) explains in further detail the operations performed by the script, and gives some more background on the data.

As mentioned in @sec-SubsecPopData, the shapefiles from the *EuroBoundaryMap* geo-database [@eurogeographics-2025-euroboundarymap-website] can be used for most countries.
Fortunately, Eurostat offers them free of charge but subject to Copyright and non-commercial use conditions on its website [@eurostat-2025-gisco-lau-download-website].[^appx-1-pop-data-1]
They can also be retrieved easily via an API, of which the R script makes use with help of the *giscoR* package [@hernangomez-2025-package-giscoR].

[^appx-1-pop-data-1]: The license specified above/below (**TODO** please reference license/license file) stipulates the use conditions for this thesis, its analysis and results, and gathers all the copyright and licensing conditions for the different data they build upon.
    For details on the mentioned copyright and restrictions also see @eurostat-2025-gisco-copyright-website for the *EuroBoundaryMap* shapefiles and @gloersen-luer-2013-report-data-collect for the historical LAU population figures and the non-*EuroBoundaryMap* shapefiles.

After retrieving the *EuroBoundaryMap* shapefiles, I manually load the separately delivered shapefiles for Greece, Ireland and Turkey [available on the same website as the historical population figures, @eurostat-2023-lau-website].
I then transform the coordinate reference systems (CRS) of all the shapefiles to ensure that they are harmonised and correspond to the CRS of the weather grid data.
While the weather grid data is retrieved with the `OGC:CRS84` CRS traditionally used for computation, the shapefiles for the LAU boundaries are provided with `EPSG:4326`, `ETRS89` or `ED50` CRS, depending on delivery.
Fortunately, the *EuroBoundaryMap* shapefiles can be used for all except the three countries mentioned before and they come with the `EPSG:4326` CRS. As the `EPSG:4326` CRS and the `OGC:CRS84` CRS both have the *WGS84* as their underlying reference ellipsoid and only differ in the longitude-latitude order, transforming the *EuroBoundaryMap* shapefiles should not produce any inaccuracies.[^appx-1-pop-data-2]
However, this is not the case for those countries that are special cases and whose LAU boundaries are specified by the separate, non-*EuroBoundaryMap* shapefiles: Greece, Ireland and Turkey LAU boundary shapefiles are delivered with the `ETRS89` or `ED50` CRS. When transforming the CRS for these shapefiles to `OGC:CRS84`, some inaccuracies may occur.
[^appx-1-pop-data-3] However, considering the research setup, the size of LAUs typically being in the $\mathrm{km}^2$ range and, in the majority of cases, weather not varying significantly within few meters, I deem those inaccuracies of maximum eight meters as neglegible
.

[^appx-1-pop-data-2]: For more details on transformation of projections and CRS, and potential inaccuracies due to that process, see also the documentation of the command `st_transform()` of the *sf* R package [@pebesma-bivand-2023-package-sf] and the EPSG simplified registry [@klokantech-2025-epsg-io].

[^appx-1-pop-data-3]: More precisely, the EPSG simplified registry [@klokantech-2025-epsg-io] indicates that for Greece (`EPSG:3035`, i.e. `ETRS89-extended`) the boundaries can be off by up to one meter and for Turkey (`EPSG:4230`, i.e. `ED50`) they can be off by up to eight meters, when transforming them to a CRS that has *WGS84* as reference ellipsoid.
    For Ireland (`EPSG:4258`, i.e. `ETRS89`), the registriy does not indicate any inaccuracies, but they are not expected to be more than those for Greece as they are also `ETRS89`-based.

Besides the issues with transforming LAU boundary shapefiles to a *WGS84*-based CRS, neither the *EuroBoundaryMap* shapefiles nor the weather grid data specify which version of the *WGS84* standard they refer to.
A point can change in coordinates across different versions of a CRS because of multiple reasons, for example an improved accuracy of the underlying reference datum or ellipsoid, an improved accuracy of the projection, or tectonic shifts.
Yet, similarly to the transformation-induced inaccuracies discussed above, I also consider these inaccuracies caused by potential version differences as minor and neglegible for this work.
Accuracy improvements and other updates to the *WGS84* standard will have shifted its CRS only by some meters at most.
In contrast to these downsides, there also some advantages to harmonising to the *WGS84*-based CRS: The weather data and the *EuroBoundaryMap* shapefiles, that cover most countries, use that standard already by delivery, allowing me to avoid inaccuracies present if I would have to transform either one of them to the standard of the other or a third one.
In addition to that, using the *WGS84* also has the advantage that it allows for consistent localisation of the European overseas territories.

**\[add here a paragraph describing the cleaning done for the shapefiles\]** After these considering the projections, the script then performs various checks and cleaning steps on the shapefiles.
It streamlines their unique identifiers (UIDs) to ensure that they correspond to the same format as the population figure data set.
In addition, the script

**\[add here a paragraph describing the cleaning done for the population figures\]**

**\[paragraph on joining process and selecting the right base year for each country\]** The @gloersen-luer-2013-report-data-collect report on the collection of the historical population figures is somewhat imprecise on whether 2011 or 2012 is the base year for the boundaries which the population figures are referred to.

**\[add here a table for the amounts of LAU units per country for the raw shapefile and population data, i.e. table_obs\]**

-   Add another column to table denoting for each country the year for which its boundaries have been recalculated (either 2011 or 2012)

```{r}
#| eval: false

shapes_2011 |> filter(startsWith(CNTR_LAU_ID, "LU")) |> ggplot() + geom_sf(aes(fill = ifelse(LAU_NAME == "Eschweiler" | LAU_NAME == "Wiltz", "Highlight", "Default"))) + scale_fill_manual(values = c("Highlight" = "red", "Default" = "grey")) +
  theme(legend.position = "none")
shapes_2012 |> filter(startsWith(CNTR_LAU_ID, "LU")) |> ggplot() + geom_sf()

```

| Country | Observations (Individ. File) | Geo Version (Individ. File) |
|---------|------------------------------|-----------------------------|
| AT      | 2357                         | 1 Jan 2012                  |
| BE      | 589                          | 1 Jan 2012                  |
| BG      | 4619                         | not specified               |
| CH      | 2499                         | not specified               |
| CY      | 614                          | not specified               |
| CZ      | 6251                         | 1 Jan 2012                  |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |
|         |                              |                             |

: Countries, their observations and geolocation characteristics

The R script [`prep-pop-data.R`](./prep-pop-data.R) documents all of the steps taken as part of the cleaning, reorganizing and georeferecing of the historic LAU population data.

ToDo: Add scatterplot for representing correlation between historic population figures and population figures delivered with shapefiles to represent strong correlation between historic interpolation and real figures.

```{r}
population |> 
  ggplot(mapping = aes(x = POP_2011_01_01, y = EUROGEOGRAPHICS_POP_2011_2012)) +
  geom_point() +
  geom_abline(slope = 1)
```

```{r}
#| eval: false

population |> 
  mutate(DEVIATION_POP_2011_EUROG = EUROGEOGRAPHICS_POP_2011_2012 / POP_2011_01_01) |> 
  filter(DEVIATION_POP_2011_EUROG > 1.05 | DEVIATION_POP_2011_EUROG < 0.95) |> 
  filter(DEVIATION_POP_2011_EUROG != 0) |> View()
```
